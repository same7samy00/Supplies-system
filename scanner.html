<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مسح باركود</title>
    <style>
        body { margin: 0; font-family: sans-serif; background-color: #f8f9fa; color: #333; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; }
        video { width: 100%; max-width: 640px; border: 1px solid #ccc; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); border-radius: 5px; }
        #status { margin-top: 1rem; font-size: 1rem; color: #555; }
        #cancelBtn { position: absolute; top: 20px; left: 20px; padding: 10px 15px; font-size: 1rem; background-color: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <video id="video"></video>
    <p id="status">جارٍ تهيئة الكاميرا...</p>
    <button id="cancelBtn" class="btn btn-danger">إلغاء</button>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@zxing/library@latest/umd/zxing.min.js"></script>
    <script type="text/javascript">
        window.addEventListener('load', () => {
            const codeReader = new ZXing.BrowserMultiFormatReader();
            const statusEl = document.getElementById('status');
            const cancelBtn = document.getElementById('cancelBtn');
            let selectedDeviceId;

            cancelBtn.addEventListener('click', () => window.close());

            codeReader.listVideoInputDevices()
                .then(videoInputDevices => {
                    const rearCamera = videoInputDevices.find(device => /back|rear|environment/i.test(device.label));
                    selectedDeviceId = rearCamera ? rearCamera.deviceId : videoInputDevices
